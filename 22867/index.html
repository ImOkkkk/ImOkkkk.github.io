<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="baidu-site-verification" content="bUCDF5pEQe">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=66522575" charset="UTF-8"></script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tonymua.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1.课程预览技术方案1.1 需求分析课程预览是为了保证课程发布后的正确性，通过课程预览可以直观的通过课程详情页面看到课程的信息是否正确， 通过课程预览看到的页面内容和课程发布后的页面内容是一致的。 1.2 课程详情页面技术方案课程预览所浏览到的页面就是课程详情页面，需要先确定课程详情页面的技术方案后方可确定课程预览的技术方 案。  1.2.1 技术需求">
<meta name="keywords" content="项目">
<meta property="og:type" content="article">
<meta property="og:title" content="学成在线(十.课程预览, 课程发布)">
<meta property="og:url" content="http://tonymua.top/22867/index.html">
<meta property="og:site_name" content="liuwy1998 BLOG">
<meta property="og:description" content="1.课程预览技术方案1.1 需求分析课程预览是为了保证课程发布后的正确性，通过课程预览可以直观的通过课程详情页面看到课程的信息是否正确， 通过课程预览看到的页面内容和课程发布后的页面内容是一致的。 1.2 课程详情页面技术方案课程预览所浏览到的页面就是课程详情页面，需要先确定课程详情页面的技术方案后方可确定课程预览的技术方 案。  1.2.1 技术需求">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-29T06:00:32.559Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学成在线(十.课程预览, 课程发布)">
<meta name="twitter:description" content="1.课程预览技术方案1.1 需求分析课程预览是为了保证课程发布后的正确性，通过课程预览可以直观的通过课程详情页面看到课程的信息是否正确， 通过课程预览看到的页面内容和课程发布后的页面内容是一致的。 1.2 课程详情页面技术方案课程预览所浏览到的页面就是课程详情页面，需要先确定课程详情页面的技术方案后方可确定课程预览的技术方 案。  1.2.1 技术需求">

<link rel="canonical" href="http://tonymua.top/22867/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>学成在线(十.课程预览, 课程发布) | liuwy1998 BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="liuwy1998 BLOG" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">liuwy1998 BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">When they go low,we go high.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">87</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">35</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tonymua.top/22867/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/../assets/img/head.jpg">
      <meta itemprop="name" content="liuwy1998">
      <meta itemprop="description" content="Java开发, 后端开发">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuwy1998 BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          学成在线(十.课程预览, 课程发布)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-08 21:19:59" itemprop="dateCreated datePublished" datetime="2021-05-08T21:19:59+08:00">2021-05-08</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="1-课程预览技术方案"><a href="#1-课程预览技术方案" class="headerlink" title="1.课程预览技术方案"></a>1.课程预览技术方案</h3><h4 id="1-1-需求分析"><a href="#1-1-需求分析" class="headerlink" title="1.1 需求分析"></a>1.1 需求分析</h4><p>课程预览是为了保证课程发布后的正确性，通过课程预览可以直观的通过课程详情页面看到课程的信息是否正确， 通过课程预览看到的页面内容和课程发布后的页面内容是一致的。</p>
<h4 id="1-2-课程详情页面技术方案"><a href="#1-2-课程详情页面技术方案" class="headerlink" title="1.2 课程详情页面技术方案"></a>1.2 课程详情页面技术方案</h4><p>课程预览所浏览到的页面就是课程详情页面，需要先确定课程详情页面的技术方案后方可确定课程预览的技术方 案。 </p>
<h5 id="1-2-1-技术需求"><a href="#1-2-1-技术需求" class="headerlink" title="1.2.1 技术需求"></a>1.2.1 技术需求</h5><a id="more"></a>

<p>课程详情页面是向用户展示课程信息的窗口，课程相当于网站的商品，本页面的访问量会非常大。此页面的内容设 计不仅要展示出课程核心重要的内容而且用户访问页面的速度要有保证，有统计显示打开一个页面超过4秒用户就 走掉了，所以本页面的性能要求是本页面的重要需求。<br>本页面另一个需求就是SEO，要非常有利于爬虫抓取页面上信息，并且生成页面快照，利于用户通过搜索引擎搜索 课程信息。 </p>
<h5 id="1-2-2-解决方案"><a href="#1-2-2-解决方案" class="headerlink" title="1.2.2 解决方案"></a>1.2.2 解决方案</h5><p>如何在保证SEO的前提下提高页面的访问速度 ：</p>
<ul>
<li><p>方案1：<br>对于信息获取类的需求，要想提高页面速度就要<strong>使用缓存来减少或避免对数据库的访问</strong>，从而提高页面的访问速度。下图是使用缓存与不使用缓存的区别<br><img data-src="../../../../assets/img/193842.jpg" alt><br>此页面为动态页面，会根据课程的不同而不同，方案一采用传统的JavaEE Servlet/jsp的方式在Tomcat完成页面渲 染，相比不加缓存速度会有提升。<br>优点：<strong>使用redis作为缓存，速度有提升</strong>。<br>缺点：采用Servlet/jsp动态页面渲染技术，服务器使用Tomcat，<strong>面对高并发量的访问存在性能瓶颈</strong>。</p>
</li>
<li><p>方案2：<br>对于不会频繁改变的信息可以采用页面静态化的技术，<strong>提前让页面生成html静态页面存储在nginx服务器</strong>，用户直接访问nginx即可，对于一些<strong>动态信息可以访问服务端获取json数据在页面渲染</strong>。<br><img data-src="../../../../assets/img/194143.jpg" alt><br>优点：使用Nginx作为web服务器，并且直接访问html页面，性能出色。<br>缺点：需要维护大量的静态页面，增加了维护的难度。</p>
</li>
</ul>
<p>选择方案2作为课程详情页面的技术解决方案，将课程详情页面生成Html静态化页面，并发布到Nginx上。</p>
<h4 id="1-3-课程预览技术方案"><a href="#1-3-课程预览技术方案" class="headerlink" title="1.3 课程预览技术方案"></a>1.3 课程预览技术方案</h4><p>根据要求：课程详情页面采用静态化技术生成Html页面，课程预览的效果要与最终静态化的Html页面内容一致。</p>
<p>所以，课程预览功能也采用静态化技术生成Html页面，课程预览使用的模板与课程详情页面模板一致，这样就可 以保证课程预览的效果与最终课程详情页面的效果一致。<br><strong>操作流程：</strong></p>
<pre><code>1. 制作课程详情页面模板
 2. 开发课程详情页面数据模型的查询接口（为静态化提供数据） 
 3. 调用cms课程预览接口通过浏览器浏览静态文件</code></pre><p><img data-src="../../../../assets/img/194423.jpg" alt></p>
<h3 id="2-课程详情页面静态化"><a href="#2-课程详情页面静态化" class="headerlink" title="2.课程详情页面静态化"></a>2.课程详情页面静态化</h3><h4 id="2-1-静态页面测试"><a href="#2-1-静态页面测试" class="headerlink" title="2.1 静态页面测试"></a>2.1 静态页面测试</h4><h5 id="2-1-1-页面内容组成"><a href="#2-1-1-页面内容组成" class="headerlink" title="2.1.1 页面内容组成"></a>2.1.1 页面内容组成</h5><p>我们在编写一个页面时需要知道哪些信息是静态信息，哪些信息为动态信息，下图是页面的设计图：</p>
<p><img data-src="../../../../assets/img/210223.jpg" alt></p>
<p>打开静态页面，观察每部分的内容。<br><strong>红色表示动态信息，红色以外表示静态信息。</strong><br>红色动态信息：表示一个按钮，根据用户的登录状态、课程的购买状态显示按钮的名称及按钮的事件。<br>包括以下信息内容：<br>(1) 课程信息<br>    课程标题、价格、课程等级、授课模式、课程图片、课程介绍、课程目录。<br>(2) 课程统计信息<br>    课程时长、评分、收藏人数<br>(3) 教育机构信息<br>    公司名称、公司简介<br>(4) 教育机构统计信息<br>    好评数、课程数、学生人数<br>(5) 教师信息<br>    老师名称、老师介绍</p>
<h5 id="2-1-2-页面拆分"><a href="#2-1-2-页面拆分" class="headerlink" title="2.1.2 页面拆分"></a>2.1.2 页面拆分</h5><p>将页面拆分成如下页面：<br>(1) 页头<br>本页头文件和门户使用的页头为同一个文件。<br>参考：代码\页面与模板\include\header.html<br>(2) 页面尾<br>本页尾文件和门户使用的页尾为同一个文件。<br>参考：代码\页面与模板\include\footer.html<br>(3) 课程详情主页面<br>每个课程对应一个文件，命名规则为：课程id.html（课程id动态变化） 模板页面<br>参考：\代码\页面与模板\course\detail\course_main_template.html<br>(4) 教育机构页面<br>每个教育机构对应一个文件，文件的命名规则为：company_info公司id.html（公司id动态变化）<br>参考：代码\页面与模板\company\company_info_template.html<br>(5)老师信息页面 每个教师信息对应一个文件，文件的命名规则为：teacher_info教师id.html（教师id动态变化）<br>参考：代码\页面与模板\teacher\teacher_info_template01.html<br>(6) 课程统计页面<br>每个课程对应一个文件，文件的命名规则为：course_stat_课程id.json（课程id动态变化）<br>参考：\代码\页面与模板\stat\course\course_stat_template.json<br>(7) 教育机构统计页面 每个教育机构对应一个文件，文件的命名规则为：company_stat公司id.json（公司id动态变化）<br>参考：\代码\页面与模板\stat\company\company_stat_template.json</p>
<h5 id="2-1-3-静态页面测试"><a href="#2-1-3-静态页面测试" class="headerlink" title="2.1.3 静态页面测试"></a>2.1.3 静态页面测试</h5><h6 id="2-1-3-1页面加载思路"><a href="#2-1-3-1页面加载思路" class="headerlink" title="2.1.3.1页面加载思路"></a>2.1.3.1页面加载思路</h6><p>打开课程资料中的“静态页面目录”中的课程详情模板页面，研究页面加载的思路。<br>模板页面路径如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">静态页面目录\static\course\detail\course_main_template.html</span><br></pre></td></tr></table></figure>

<p>(1) 主页面<br>我们需要在主页面中通过SSI加载：页头、页尾、教育机构、教师信息<br>(2) 异步加载课程统计与教育机构统计信息<br>课程统计信息（json）、教育机构统计信息（json）<br>(3) 马上学习按钮事件<br>用户点击“马上学习”会根据课程收费情况、课程购买情况执行下一步操作。</p>
<h6 id="2-1-3-2-静态资源虚拟主机"><a href="#2-1-3-2-静态资源虚拟主机" class="headerlink" title="2.1.3.2 静态资源虚拟主机"></a>2.1.3.2 静态资源虚拟主机</h6><p>1.配置静态资源虚拟主机<br>静态资源虚拟主机负责处理课程详情、公司信息、老师信息、统计信息等页面的请求：<br>将课程资料中的“静态页面目录”中的目录拷贝到F:/develop/xuecheng/static下<br>在nginx中配置静态虚拟主机如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#学成网静态资源</span></span><br><span class="line">   server&#123;</span><br><span class="line"><span class="attribute">listen</span>	<span class="number">91</span>;</span><br><span class="line"><span class="attribute">server_name</span>  localhost;</span><br><span class="line"><span class="comment">#公司信息</span></span><br><span class="line"><span class="attribute">location</span> /static/company/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xuecheng/static/company/;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">#老师信息</span></span><br><span class="line"><span class="attribute">location</span> /static/teacher/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xuecheng/static/teacher/;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">#统计信息</span></span><br><span class="line"><span class="attribute">location</span> /static/stat/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xuecheng/static/stat/;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="attribute">location</span> /course/detail/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xuecheng/static/course/detail/;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.通过<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb23omZrmi5/kuLvmnLrovazlj5HliLDpnZnmgIHotYTmupA=">www.xuecheng.com虚拟主机转发到静态资源<i class="fa fa-external-link-alt"></i></span><br>由于课程页面需要通过SSI加载页头和页尾所以需要通过<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb23omZrmi5/kuLvmnLrovazlj5HliLDpnZnmgIHotYTmupA=">www.xuecheng.com虚拟主机转发到静态资源<i class="fa fa-external-link-alt"></i></span><br>在<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb23omZrmi5/kuLvmnLrliqDlhaXlpoLkuIvphY3nva7vvJo=">www.xuecheng.com虚拟主机加入如下配置：<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /static/company/&#123;</span><br><span class="line">	<span class="attribute">proxy_pass</span> http://static_server_pool;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static/teacher/&#123;</span><br><span class="line">	<span class="attribute">proxy_pass</span> http://static_server_pool;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static/stat/&#123;</span><br><span class="line">	<span class="attribute">proxy_pass</span> http://static_server_pool;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /course/detail/&#123;</span><br><span class="line">	<span class="attribute">proxy_pass</span> http://static_server_pool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.配置upstream实现请求转发到资源服务虚拟主机：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#静态资源服务</span></span><br><span class="line"><span class="attribute">upstream</span> static_server_pool&#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:91</span>	weight=<span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="2-1-3-3-门户静态资源路径"><a href="#2-1-3-3-门户静态资源路径" class="headerlink" title="2.1.3.3 门户静态资源路径"></a>2.1.3.3 门户静态资源路径</h6><p>门户中的一些图片、样式等静态资源统一通过/static路径对外提供服务，在<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb23omZrmi5/kuLvmnLrkuK3phY3nva7lpoLkuIvvvJo=">www.xuecheng.com虚拟主机中配置如下：<i class="fa fa-external-link-alt"></i></span></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#静态资源,包括系统所需的图片 js css等静态资源</span></span><br><span class="line"><span class="attribute">location</span> /static/img/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xc-ui-pc-static-portal/img/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static/css/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xc-ui-pc-static-portal/css/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static/js/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xc-ui-pc-static-portal/js/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /static/plugins/&#123;</span><br><span class="line">	<span class="attribute">alias</span>	E:/IdeaProject/xc-ui-pc-static-portal/plugins/;</span><br><span class="line">	<span class="attribute">add_header</span> Access-Control-Allow-Origin http://ucenter.xuecheng.com;</span><br><span class="line">	<span class="attribute">add_header</span> Access-Control-Allow-Credentials <span class="literal">true</span>;</span><br><span class="line">	<span class="attribute">add_header</span> Access-Control-Allow-Methods GET;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>cors跨域参数：</strong><br>Access-Control-Allow-Origin：允许跨域访问的外域地址<br>如果允许任何站点跨域访问则设置为*，通常这是不建议的。 </p>
<p>Access-Control-Allow-Credentials： 允许客户端携带证书访问<br>Access-Control-Allow-Methods：允许客户端跨域访问的方法 </p>
</li>
</ul>
<h6 id="2-1-3-4-页面测试"><a href="#2-1-3-4-页面测试" class="headerlink" title="2.1.3.4 页面测试"></a>2.1.3.4 页面测试</h6><p>请求：<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb20vY291cnNlL2RldGFpbC9jb3Vyc2VfbWFpbl90ZW1wbGF0ZS5odG1s5rWL6K+V6K++56iL6K+m5oOF6aG16Z2i5qih5p2/5piv5ZCm5Y+v5Lul5q2j5bi45rWP6KeI44CC">http://www.xuecheng.com/course/detail/course_main_template.html测试课程详情页面模板是否可以正常浏览。<i class="fa fa-external-link-alt"></i></span></p>
<p><img data-src="../../../../assets/img/210224.jpg" alt></p>
<h4 id="2-2-课程数据模型查询接口"><a href="#2-2-课程数据模型查询接口" class="headerlink" title="2.2 课程数据模型查询接口"></a>2.2 课程数据模型查询接口</h4><p>静态化操作需要模型数据方可进行静态化，课程数据模型由课程管理服务提供，仅供课程静态化程序调用使用。 </p>
<h5 id="2-2-1-接口定义"><a href="#2-2-1-接口定义" class="headerlink" title="2.2.1 接口定义"></a>2.2.1 接口定义</h5><p>1.响应结果类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseView</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CourseBase courseBase;</span><br><span class="line">    <span class="keyword">private</span> CoursePic coursePic;</span><br><span class="line">    <span class="keyword">private</span> CourseMarket courseMarket;</span><br><span class="line">    <span class="keyword">private</span> TeachplanNode teachplanNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.请求类型</p>
<p>String：课程id </p>
<p>3.接口定义如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"课程视图查询"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseView <span class="title">courseview</span><span class="params">(String id)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-2-Controller"><a href="#2-2-2-Controller" class="headerlink" title="2.2.2 Controller"></a>2.2.2 Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/courseview/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseView <span class="title">courseview</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> courseService.getCourseView(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-Dao"><a href="#2-2-3-Dao" class="headerlink" title="2.2.3 Dao"></a>2.2.3 Dao</h5><p>需要对course_base、course_market、course_pic、teachplan等信息进行查询， 新建课程营销的dao，其它dao已经存在不用再建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseMarketRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">CourseMarket</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-4-Service"><a href="#2-2-4-Service" class="headerlink" title="2.2.4 Service"></a>2.2.4 Service</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CourseView <span class="title">getCourseView</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    CourseView courseView=<span class="keyword">new</span> CourseView();</span><br><span class="line">    <span class="comment">//查询课程基本信息</span></span><br><span class="line">    CourseBase courseBase = getCourseById(id);</span><br><span class="line">    courseView.setCourseBase(courseBase);</span><br><span class="line">    <span class="comment">//查询课程图片</span></span><br><span class="line">    CoursePic coursePic = findCoursePic(id);</span><br><span class="line">    courseView.setCoursePic(coursePic);</span><br><span class="line">    <span class="comment">//查询课程营销信息</span></span><br><span class="line">    CourseMarket courseMarket = getCourseMarketById(id);</span><br><span class="line">    courseView.setCourseMarket(courseMarket);</span><br><span class="line">    <span class="comment">//查询课程计划信息</span></span><br><span class="line">    TeachplanNode teachplanNode = findTeachplanList(id);</span><br><span class="line">    courseView.setTeachplanNode(teachplanNode);</span><br><span class="line">    <span class="keyword">return</span> courseView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-5-测试"><a href="#2-2-5-测试" class="headerlink" title="2.2.5 测试"></a>2.2.5 测试</h5><p>使用swagger-ui或postman测试本接口。</p>
<p><img data-src="../../../../assets/img/093239.jpg" alt></p>
<h4 id="2-3-课程信息模板设计"><a href="#2-3-课程信息模板设计" class="headerlink" title="2.3  课程信息模板设计"></a>2.3  课程信息模板设计</h4><p>在确定了静态化所需要的数据模型之后，就可以编写页面模板了，课程详情页面由多个静态化页面组成，所以我们需要创建多个页面模板，本章节创建课程详情页面的主模板，即课程信息模板。</p>
<h5 id="2-3-1-模板测试"><a href="#2-3-1-模板测试" class="headerlink" title="2.3.1 模板测试"></a>2.3.1 模板测试</h5><p>使用test-freemarker工程测试模板<br>编写模板过程采用test-freemarker工程测试模板。 </p>
<p>将course.ftl拷贝到test-freemarker工程的resources/templates下，并在test-freemarker工程的controller中添加测试方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/course"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">course</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>&#123;</span><br><span class="line">    ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(<span class="string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span>, Map<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    Map body = forEntity.getBody();</span><br><span class="line">    map.putAll(body);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"course"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：上边的测试页面不显示样式，原因是页面通过SSI包含了页面头，而使用test-freemarker工程无法加载页 头，测试模板主要查看html页面内容是否正确，待课程预览时解决样式不显示问题</p>
<h5 id="2-3-2-模板保存"><a href="#2-3-2-模板保存" class="headerlink" title="2.3.2 模板保存"></a>2.3.2 模板保存</h5><p>模板编写并测试通过后要在数据库保存：<br>1.模板信息保存在xc_cms数据库(mongodb)的cms_template表<br>2.模板文件保存在mongodb的GridFS中。 </p>
<p>第一步：将模板文件上传到GridFS中 由于本教学项目中模板管理模块没有开发，所以我们使用Junit代码向GridFS中保存：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStore2</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">    File file=<span class="keyword">new</span> File(<span class="string">"e:/IdeaProject/xuecheng/test-freemarker/src/main/resources/templates/course.ftl"</span>);</span><br><span class="line">    FileInputStream fileInputStream=<span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">    ObjectId id = gridFsTemplate.store(fileInputStream, <span class="string">"课程详情模板文件"</span>);</span><br><span class="line">    System.out.println(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存成功需要记录模板文件的id，即上边代码中的ﬁleId。 </p>
<p>第二步：向cms_template表添加模板记录（请不要重复添加）<br>使用Studio 3T连接mongodb，向cms_template添加记录：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    <span class="attr">"_id"</span> : ObjectId(<span class="string">"5ad9a24d68db5239b8fef199"</span>), </span><br><span class="line">    <span class="attr">"_class"</span> : <span class="string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>, </span><br><span class="line">    <span class="attr">"siteId"</span> : <span class="string">"5a751fab6abb5044e0d19ea1"</span>, </span><br><span class="line">    <span class="attr">"templateName"</span> : <span class="string">"课程详情页面测试"</span>, </span><br><span class="line">    <span class="attr">"templateParameter"</span> : <span class="string">"courseid"</span>, </span><br><span class="line">    <span class="attr">"templateFileId"</span> : <span class="string">"5e09668d69ffad2fd40dc35d"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-3-其它模板"><a href="#2-3-3-其它模板" class="headerlink" title="2.3.3 其它模板"></a>2.3.3 其它模板</h5><p>除了课程详情主页面需要设计模板所有静态化的页面都要设计模板，如下：<br>教育机构页面模板、教师信息页面模板、课程统计信息json模板、教育机构统计信息json模板。<br>本项目我们实现课程详情主页面模板的制作和测试，其它页面模板的开发参考课程详情页面去实现。</p>
<h3 id="3-课程预览功能开发"><a href="#3-课程预览功能开发" class="headerlink" title="3.课程预览功能开发"></a>3.课程预览功能开发</h3><h4 id="3-1-需求分析"><a href="#3-1-需求分析" class="headerlink" title="3.1 需求分析"></a>3.1 需求分析</h4><p>课程预览功能将使用cms系统提供的页面预览功能，业务流程如下：<br>(1) 用户进入课程管理页面，点击课程预览，请求到课程管理服务<br>(2) 课程管理服务远程调用cms添加页面接口向cms添加课程详情页面<br>(3) 课程管理服务得到cms返回课程详情页面id，并拼接生成课程预览Url<br>(4) 课程管理服务将课程预览Url给前端返回<br>(5) 用户在前端页面请求课程预览Url，打开新窗口显示课程详情内容</p>
<p><img data-src="../../../../assets/img/161302.jpg" alt></p>
<h4 id="3-2-CMS页面预览测试"><a href="#3-2-CMS页面预览测试" class="headerlink" title="3.2 CMS页面预览测试"></a>3.2 CMS页面预览测试</h4><p>CMS已经提供了页面预览功能，课程预览功能要使用CMS页面预览接口实现，下边通过cms页面预览接口测试课 程预览的效果。</p>
<p>1.向cms_page表插入一条页面记录或者从cms_page找一个页面进行测试。<br>注意：页面配置一定要正确，需设置正确的模板id和dataUrl。<br>如下，是一条页面的记录。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    <span class="attr">"_id"</span> : ObjectId(<span class="string">"5b3469f794db44269cb2bff1"</span>), </span><br><span class="line">    <span class="attr">"_class"</span> : <span class="string">"com.xuecheng.framework.domain.cms.CmsPage"</span>, </span><br><span class="line">    <span class="attr">"siteId"</span> : <span class="string">"5a751fab6abb5044e0d19ea1"</span>, </span><br><span class="line">    <span class="attr">"pageName"</span> : <span class="string">"4028e581617f945f01617f9dabc40000.html"</span>, </span><br><span class="line">    <span class="attr">"pageAliase"</span> : <span class="string">"课程详情页面测试01"</span>, </span><br><span class="line">    <span class="attr">"pageWebPath"</span> : <span class="string">"/course/detail/"</span>, </span><br><span class="line">    <span class="attr">"pagePhysicalPath"</span> : <span class="string">"/course/detail/"</span>, </span><br><span class="line">    <span class="attr">"pageType"</span> : <span class="string">"1"</span>, </span><br><span class="line">    <span class="attr">"pageCreateTime"</span> : ISODate(<span class="string">"2018-02-25T01:37:25.974+0000"</span>), </span><br><span class="line">    <span class="attr">"templateId"</span> : <span class="string">"5ad9a24d68db5239b8fef199"</span>, </span><br><span class="line">    <span class="attr">"dataUrl"</span> : 					<span class="string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.课程详细页面<br><strong>使用ssi注意</strong><br>由于Nginx先请求cms的课程预览功能得到html页面，再解析页面中的ssi标签，这里必须保证cms页面预览返回的 页面的Content-Type为text/html;charset=utf-8 在cms页面预览的controller方法中添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">"Content-type"</span>,<span class="string">"text/html;charset=utf-8"</span>);</span><br></pre></td></tr></table></figure>

<p>3.测试<br>请求：<span class="exturl" data-url="aHR0cDovL3d3dy54dWVjaGVuZy5jb20vY21zL3ByZXZpZXcvNWIzNDY5Zjc5NGRiNDQyNjljYjJiZmYx5Lyg5YWl6aG16Z2iSWTvvIzmtYvor5XmlYjmnpzlpoLkuIs=">http://www.xuecheng.com/cms/preview/5b3469f794db44269cb2bff1传入页面Id，测试效果如下<i class="fa fa-external-link-alt"></i></span>:<br><img data-src="../../../../assets/img/195802.jpg" alt></p>
<h4 id="3-3-CMS添加页面服务端"><a href="#3-3-CMS添加页面服务端" class="headerlink" title="3.3 CMS添加页面服务端"></a>3.3 CMS添加页面服务端</h4><p>cms服务对外提供添加页面接口，实现：如果不存在页面则添加，否则就更新页面信息。<br>此接口由课程管理服务在课程预览时调用。 </p>
<h5 id="3-3-1-Api接口"><a href="#3-3-1-Api接口" class="headerlink" title="3.3.1 Api接口"></a>3.3.1 Api接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"保存页面"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsPageResult <span class="title">save</span><span class="params">(CmsPage cmsPage)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="3-3-2-Controller"><a href="#3-3-2-Controller" class="headerlink" title="3.3.2 Controller"></a>3.3.2 Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CmsPageResult <span class="title">save</span><span class="params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageService.save(cmsPage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-3-3-Service"><a href="#3-3-3-Service" class="headerlink" title="3.3.3 Service"></a>3.3.3 Service</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加页面，如果已存在则更新页面 </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsPageResult <span class="title">save</span><span class="params">(CmsPage cmsPage)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//校验页面是否存在，根据页面名称、站点Id、页面webpath查询 </span></span><br><span class="line">    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());</span><br><span class="line">    <span class="keyword">if</span> (cmsPage1!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//更新</span></span><br><span class="line">        <span class="keyword">return</span> edit(cmsPage1.getPageId(),cmsPage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> add(cmsPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-课程预览服务端"><a href="#3-4-课程预览服务端" class="headerlink" title="3.4 课程预览服务端"></a>3.4 课程预览服务端</h4><h5 id="3-4-1-Api定义"><a href="#3-4-1-Api定义" class="headerlink" title="3.4.1 Api定义"></a>3.4.1 Api定义</h5><p>此Api是课程管理前端请求服务端进行课程预览的Api 请求：课程Id<br>响应：课程预览Url </p>
<p>1.定义响应类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoursePublishResult</span> <span class="keyword">extends</span> <span class="title">ResponseResult</span> </span>&#123;</span><br><span class="line">    String previewUrl;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CoursePublishResult</span><span class="params">(ResultCode resultCode,String previewUrl)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(resultCode);</span><br><span class="line">        <span class="keyword">this</span>.previewUrl=previewUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.接口定义如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"课程预览"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">preview</span><span class="params">(String id)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="3-4-2-Controller"><a href="#3-4-2-Controller" class="headerlink" title="3.4.2 Controller"></a>3.4.2 Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/preview/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">preview</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> courseService.preview(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-4-3-创建-Feign-Client"><a href="#3-4-3-创建-Feign-Client" class="headerlink" title="3.4.3 创建 Feign Client"></a>3.4.3 创建 Feign Client</h5><p>在课程管理工程创建CMS服务的Feign Client，通过此Client远程请求cms添加页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"XC-SERVICE-MANAGE-CMS"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CmsPageClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">//保存页面</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/cms/page/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CmsPageResult <span class="title">save</span><span class="params">(@RequestBody CmsPage cmsPage)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意: CmsPageResult需要添加无参构造</strong><code>@NoArgsConstructor</code></p>
<h5 id="3-4-4-Service"><a href="#3-4-4-Service" class="headerlink" title="3.4.4  Service"></a>3.4.4  Service</h5><p>(1) 配置添加页面参数信息<br>在application.yml中配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">course‐publish:</span></span><br><span class="line">  <span class="attr">siteId:</span> <span class="string">5a751fab6abb5044e0d19ea1</span></span><br><span class="line">  <span class="attr">templateId:</span> <span class="string">5ad9a24d68db5239b8fef199</span></span><br><span class="line">  <span class="attr">previewUrl:</span> <span class="string">http://www.xuecheng.com/cms/preview/</span></span><br><span class="line">  <span class="attr">pageWebPath:</span> <span class="string">/course/detail/</span></span><br><span class="line">  <span class="attr">pagePhysicalPath:</span> <span class="string">/course/detail/</span></span><br><span class="line">  <span class="attr">dataUrlPre:</span> <span class="string">http://localhost:31200/course/courseview/</span></span><br></pre></td></tr></table></figure>

<p>(2) 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.dataUrlPre&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String publish_dataUrlPre;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.pagePhysicalPath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String publish_page_physicalpath;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.pageWebPath&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String publish_page_webpath;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.siteId&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String publish_siteId;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.templateId&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String publish_templateId;</span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;course‐publish.previewUrl&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String previewUrl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//课程预览</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">preview</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询课程</span></span><br><span class="line">    CourseBase courseBase = findCourseBaseById(id);</span><br><span class="line">    <span class="comment">//请求cms添加页面</span></span><br><span class="line">    <span class="comment">//准备cmsPage信息</span></span><br><span class="line">    CmsPage cmsPage=<span class="keyword">new</span> CmsPage();</span><br><span class="line">    cmsPage.setSiteId(publish_siteId);</span><br><span class="line">    cmsPage.setDataUrl(publish_dataUrlPre+id);</span><br><span class="line">    cmsPage.setTemplateId(publish_templateId);</span><br><span class="line">    cmsPage.setPageName(id+<span class="string">".html"</span>);</span><br><span class="line">    cmsPage.setPageAliase(courseBase.getName());</span><br><span class="line">    cmsPage.setPagePhysicalPath(publish_page_physicalpath);</span><br><span class="line">    cmsPage.setPageWebPath(publish_page_webpath);</span><br><span class="line">    <span class="comment">//远程调用cms</span></span><br><span class="line">    CmsPageResult cmsPageResult = cmsPageClient.save(cmsPage);</span><br><span class="line">    <span class="keyword">if</span> (!cmsPageResult.isSuccess())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String pageId = cmsPageResult.getCmsPage().getPageId();</span><br><span class="line">    <span class="comment">//拼接页面预览的url</span></span><br><span class="line">    String url=previewUrl+pageId;</span><br><span class="line">    <span class="comment">//返回CoursePublishResult对象(当中包含了页面预览的url)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseBase <span class="title">findCourseBaseById</span><span class="params">(String courseId)</span></span>&#123;</span><br><span class="line">    Optional&lt;CourseBase&gt; optional = courseBaseRepository.findById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (optional.isPresent())&#123;</span><br><span class="line">        CourseBase courseBase = optional.get();</span><br><span class="line">        <span class="keyword">return</span> courseBase;</span><br><span class="line">    &#125;</span><br><span class="line">    ExceptionCast.cast(CourseCode.COURSE_GET_NOTEXISTS);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-课程发布"><a href="#4-课程发布" class="headerlink" title="4.课程发布"></a>4.课程发布</h3><h4 id="4-1-需求分析"><a href="#4-1-需求分析" class="headerlink" title="4.1 需求分析"></a>4.1 需求分析</h4><p>课程发布后将生成正式的课程详情页面，课程发布后用户即可浏览课程详情页面，并开始课程的学习。<br>课程发布生成课程详情页面的流程与课程预览业务流程相同，如下：<br>(1) 用户进入教学管理中心，进入某个课程的管理界面<br>(2) 点击课程发布，前端请求到课程管理服务<br>(3) 课程管理服务远程调用CMS生成课程发布页面，CMS将课程详情页面发布到服务器<br>(4) 课程管理服务修改课程发布状态为 “已发布”，并向前端返回发布成功<br>(5) 用户在教学管理中心点击“课程详情页面”链接，查看课程详情页面内容 </p>
<p><img data-src="../../../../assets/img/094426.jpg" alt></p>
<h4 id="4-2-CMS一键发布接口"><a href="#4-2-CMS一键发布接口" class="headerlink" title="4.2 CMS一键发布接口"></a>4.2 CMS一键发布接口</h4><h5 id="4-2-1-需求分析"><a href="#4-2-1-需求分析" class="headerlink" title="4.2.1 需求分析"></a>4.2.1 需求分析</h5><p>根据需求分析内容，需要在cms服务增加页面发布接口供课程管理服务调用，此接口的功能如下：<br>(1) 接收课程管理服务发布的页面信息<br>(2) 将页面信息添加到数据库（mongodb）<br>(3) 对页面信息进行静态化<br>(4) 将页面信息发布到服务器 </p>
<h5 id="4-2-2-接口定义"><a href="#4-2-2-接口定义" class="headerlink" title="4.2.2 接口定义"></a>4.2.2 接口定义</h5><p>1.创建响应结果类型 页面发布成功cms返回页面的url<br>页面Url= cmsSite.siteDomain+cmsSite.siteWebPath+ cmsPage.pageWebPath + cmsPage.pageName</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsPostPageResult</span> <span class="keyword">extends</span> <span class="title">ResponseResult</span> </span>&#123;</span><br><span class="line">    String pageUrl;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CmsPostPageResult</span><span class="params">(ResultCode resultCode,String pageUrl)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(resultCode);</span><br><span class="line">        <span class="keyword">this</span>.pageUrl=pageUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.在api工程定义页面发布接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"一键发布页面"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsPostPageResult <span class="title">postPageQuick</span><span class="params">(CmsPage cmsPage)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="4-2-3-服务端开发"><a href="#4-2-3-服务端开发" class="headerlink" title="4.2.3 服务端开发"></a>4.2.3 服务端开发</h5><p><strong>1. 站点dao</strong><br>接口中需要获取站点的信息（站点域名、站点访问路径等）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CmsSiteRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">CmsSite</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.Controller</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/postPageQuick"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsPostPageResult <span class="title">postPageQuick</span><span class="params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> pageService.postPageQuick(cmsPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.Service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一键发布页面</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsPostPageResult <span class="title">postPageQuick</span><span class="params">(CmsPage cmsPage)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//添加页面</span></span><br><span class="line">    CmsPageResult save = save(cmsPage);</span><br><span class="line">    <span class="keyword">if</span> (!save.isSuccess()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CmsPostPageResult(CommonCode.FAIL, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//要发布的页面id</span></span><br><span class="line">    CmsPage cmsPage1 = save.getCmsPage();</span><br><span class="line">    String pageId = cmsPage1.getPageId();</span><br><span class="line">    <span class="comment">//发布页面</span></span><br><span class="line">    ResponseResult post = post(pageId);</span><br><span class="line">    <span class="keyword">if</span> (!post.isSuccess()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CmsPostPageResult(CommonCode.FAIL, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到页面的url        </span></span><br><span class="line">    <span class="comment">//页面url=站点域名+站点webpath+页面webpath+页面名称         </span></span><br><span class="line">    <span class="comment">//站点id</span></span><br><span class="line">    String siteId = cmsPage1.getSiteId();</span><br><span class="line">    <span class="comment">//查询站点信息</span></span><br><span class="line">    CmsSite cmsSite = findCmsSiteById(siteId);</span><br><span class="line">    <span class="comment">//站点域名</span></span><br><span class="line">    String siteDomain = cmsSite.getSiteDomain();</span><br><span class="line">    <span class="comment">//站点web路径</span></span><br><span class="line">    String siteWebPath = cmsSite.getSiteWebPath();</span><br><span class="line">    <span class="comment">//页面web路径</span></span><br><span class="line">    String pageWebPath = cmsPage1.getPageWebPath();</span><br><span class="line">    <span class="comment">//页面名称</span></span><br><span class="line">    String pageName = cmsPage1.getPageName();</span><br><span class="line">    <span class="comment">//页面的web访问地址</span></span><br><span class="line">    String pageUrl=siteDomain+siteWebPath+pageWebPath+pageName;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CmsPostPageResult(CommonCode.SUCCESS,pageUrl);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据id查询站点信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CmsSite <span class="title">findCmsSiteById</span><span class="params">(String siteId)</span> </span>&#123;</span><br><span class="line">    Optional&lt;CmsSite&gt; optional = cmsSiteRepository.findById(siteId);</span><br><span class="line">    <span class="keyword">if</span> (optional.isPresent())&#123;</span><br><span class="line">        <span class="keyword">return</span> optional.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-课程发布接口"><a href="#4-3-课程发布接口" class="headerlink" title="4.3 课程发布接口"></a>4.3 课程发布接口</h4><h5 id="4-3-1-Api接口"><a href="#4-3-1-Api接口" class="headerlink" title="4.3.1 Api接口"></a>4.3.1 Api接口</h5><p>此Api接口由课程管理提供，由课程管理前端调用此Api接口，实现课程发布。 在api工程下课程管理包下定义接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"课程发布"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">publish</span><span class="params">(String id)</span></span>;</span><br></pre></td></tr></table></figure>

<h5 id="4-3-2-创建Feign-Client"><a href="#4-3-2-创建Feign-Client" class="headerlink" title="4.3.2 创建Feign Client"></a>4.3.2 创建Feign Client</h5><p>在课程管理工程创建CMS服务页面发布的Feign Client</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"XC-SERVICE-MANAGE-CMS"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CmsPageClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一键发布页面</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/cms/page/postPageQuick"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CmsPostPageResult <span class="title">postPageQuick</span><span class="params">(CmsPage cmsPage)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-3-3-Controller"><a href="#4-3-3-Controller" class="headerlink" title="4.3.3 Controller"></a>4.3.3 Controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/publish/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">publish</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> courseService.publish(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-3-4-Service"><a href="#4-3-4-Service" class="headerlink" title="4.3.4 Service"></a>4.3.4 Service</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CoursePublishResult <span class="title">publish</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//准备页面信息</span></span><br><span class="line">        <span class="comment">//查询课程</span></span><br><span class="line">        CourseBase courseBase = findCourseBaseById(id);</span><br><span class="line">        CmsPage cmsPage=<span class="keyword">new</span> CmsPage();</span><br><span class="line">        cmsPage.setSiteId(publish_siteId);</span><br><span class="line">        cmsPage.setDataUrl(publish_dataUrlPre+id);</span><br><span class="line">        cmsPage.setTemplateId(publish_templateId);</span><br><span class="line">        cmsPage.setPageName(id+<span class="string">".html"</span>);</span><br><span class="line">        cmsPage.setPageAliase(courseBase.getName());</span><br><span class="line">        cmsPage.setPagePhysicalPath(publish_page_physicalpath);</span><br><span class="line">        cmsPage.setPageWebPath(publish_page_webpath);</span><br><span class="line">        <span class="comment">//调用CMS一键发布接口将课程详情页面发布到服务器</span></span><br><span class="line">        CmsPostPageResult cmsPostPageResult = cmsPageClient.postPageQuick(cmsPage);</span><br><span class="line">        <span class="keyword">if</span> (!cmsPostPageResult.isSuccess())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//保存课程的发布状态为"已发布"</span></span><br><span class="line">        CourseBase base = saveCoursePubState(id);</span><br><span class="line">        <span class="keyword">if</span> (base==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//得到页面url</span></span><br><span class="line">        String pageUrl = cmsPostPageResult.getPageUrl();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,pageUrl);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseBase <span class="title">saveCoursePubState</span><span class="params">(String courseId)</span></span>&#123;</span><br><span class="line">        CourseBase courseBase = findCourseBaseById(courseId);</span><br><span class="line">        <span class="comment">//更新发布状态</span></span><br><span class="line">        courseBase.setStatus(<span class="string">"202002"</span>);</span><br><span class="line">        CourseBase save = courseBaseRepository.save(courseBase);</span><br><span class="line">        <span class="keyword">return</span> save;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        <div class="reward-container">
  <div>请作者喝瓶肥宅快乐水</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/assets/img/vxpay.jpg" alt="liuwy1998 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/assets/img/alipay.jpg" alt="liuwy1998 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/项目/" rel="tag"><i class="fa fa-tag"></i> 项目</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/35259/" rel="prev" title="学成在线(六.页面发布, 课程管理)">
      <i class="fa fa-chevron-left"></i> 学成在线(六.页面发布, 课程管理)
    </a></div>
      <div class="post-nav-item">
    <a href="/42236/" rel="next" title="学成在线(十一.ElasticSearch(一))">
      学成在线(十一.ElasticSearch(一)) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-课程预览技术方案"><span class="nav-text">1.课程预览技术方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-需求分析"><span class="nav-text">1.1 需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-课程详情页面技术方案"><span class="nav-text">1.2 课程详情页面技术方案</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-技术需求"><span class="nav-text">1.2.1 技术需求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-解决方案"><span class="nav-text">1.2.2 解决方案</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-课程预览技术方案"><span class="nav-text">1.3 课程预览技术方案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-课程详情页面静态化"><span class="nav-text">2.课程详情页面静态化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-静态页面测试"><span class="nav-text">2.1 静态页面测试</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-1-页面内容组成"><span class="nav-text">2.1.1 页面内容组成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-2-页面拆分"><span class="nav-text">2.1.2 页面拆分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-3-静态页面测试"><span class="nav-text">2.1.3 静态页面测试</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#2-1-3-1页面加载思路"><span class="nav-text">2.1.3.1页面加载思路</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-1-3-2-静态资源虚拟主机"><span class="nav-text">2.1.3.2 静态资源虚拟主机</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-1-3-3-门户静态资源路径"><span class="nav-text">2.1.3.3 门户静态资源路径</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-1-3-4-页面测试"><span class="nav-text">2.1.3.4 页面测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-课程数据模型查询接口"><span class="nav-text">2.2 课程数据模型查询接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-1-接口定义"><span class="nav-text">2.2.1 接口定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-Controller"><span class="nav-text">2.2.2 Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-3-Dao"><span class="nav-text">2.2.3 Dao</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-4-Service"><span class="nav-text">2.2.4 Service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-5-测试"><span class="nav-text">2.2.5 测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-课程信息模板设计"><span class="nav-text">2.3  课程信息模板设计</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-1-模板测试"><span class="nav-text">2.3.1 模板测试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-2-模板保存"><span class="nav-text">2.3.2 模板保存</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-3-其它模板"><span class="nav-text">2.3.3 其它模板</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-课程预览功能开发"><span class="nav-text">3.课程预览功能开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-需求分析"><span class="nav-text">3.1 需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-CMS页面预览测试"><span class="nav-text">3.2 CMS页面预览测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-CMS添加页面服务端"><span class="nav-text">3.3 CMS添加页面服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-1-Api接口"><span class="nav-text">3.3.1 Api接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-Controller"><span class="nav-text">3.3.2 Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-3-Service"><span class="nav-text">3.3.3 Service</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-课程预览服务端"><span class="nav-text">3.4 课程预览服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-1-Api定义"><span class="nav-text">3.4.1 Api定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-2-Controller"><span class="nav-text">3.4.2 Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-3-创建-Feign-Client"><span class="nav-text">3.4.3 创建 Feign Client</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-4-4-Service"><span class="nav-text">3.4.4  Service</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-课程发布"><span class="nav-text">4.课程发布</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-需求分析"><span class="nav-text">4.1 需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-CMS一键发布接口"><span class="nav-text">4.2 CMS一键发布接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-需求分析"><span class="nav-text">4.2.1 需求分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-接口定义"><span class="nav-text">4.2.2 接口定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-3-服务端开发"><span class="nav-text">4.2.3 服务端开发</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-课程发布接口"><span class="nav-text">4.3 课程发布接口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-1-Api接口"><span class="nav-text">4.3.1 Api接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-2-创建Feign-Client"><span class="nav-text">4.3.2 创建Feign Client</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-3-Controller"><span class="nav-text">4.3.3 Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-3-4-Service"><span class="nav-text">4.3.4 Service</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liuwy1998"
      src="/../assets/img/head.jpg">
  <p class="site-author-name" itemprop="name">liuwy1998</p>
  <div class="site-description" itemprop="description">Java开发, 后端开发</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">87</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vNjA2MjE3MjIyNC8=" title="Weibo → https://weibo.com/6062172224/"><i class="fab fa-weibo fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RvbnltdWE=" title="GitHub → https://github.com/tonymua"><i class="fab fa-github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmx3eTA4YUBmb3htYWlsLmNvbQ==" title="E-Mail → mailto:lwy08a@foxmail.com"><i class="fa fa-envelope fa-fw"></i></span>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">皖ICP备19022525号 </span>
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liuwy1998</span>
</div><script color="0,137,108" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>












  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://tonymua.top/22867/',]
      });
      });
  </script>

</body>
</html>
